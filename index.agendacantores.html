<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Entradas ‚Ä¢ Grupo DV</title>
  <style>
    :root{
      --bg:#0b1020; --surface:#10172a; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8;
      --line:rgba(148,163,184,.25); --icon-bg:rgba(255,255,255,.06);
      --shadow:0 20px 60px rgba(2,6,23,.35); --ok:#16a34a; --bad:#dc2626;
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --surface:#fff; --card:#fff; --text:#0f172a; --muted:#475569;
      --line:#e5e7eb; --icon-bg:rgba(2,6,23,.06); --shadow:0 16px 36px rgba(15,23,42,.08);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:ui-sans-serif,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    header{position:sticky;top:0;z-index:40;backdrop-filter:saturate(160%) blur(8px);
      background:color-mix(in srgb,var(--surface) 85%,transparent);border-bottom:1px solid var(--line);}
    .head{max-width:1200px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
    .brand img{height:42px}
    .title{font-weight:800;font-size:clamp(18px,1.6vw,22px)}
    .grow{flex:1}
    .btn{border:1px solid var(--line);background:var(--surface);color:var(--text);
      padding:10px 12px;border-radius:12px;font-weight:800;cursor:pointer;display:inline-flex;gap:8px;align-items:center}
    .btn:hover{box-shadow:var(--shadow);transform:translateY(-1px)}
    .user{position:relative}
    .user-btn{display:flex;align-items:center;gap:10px;border:1px solid var(--line);
      background:var(--surface);padding:6px 8px;border-radius:999px;cursor:pointer}
    .user-btn img{width:34px;height:34px;border-radius:50%;object-fit:cover;background:var(--icon-bg)}
    .user-menu{position:absolute;right:0;top:110%;background:var(--surface);border:1px solid var(--line);
      border-radius:12px;min-width:200px;padding:6px;box-shadow:var(--shadow);display:none}
    .user.open .user-menu{display:block}
    .container{max-width:1200px;margin:0 auto;padding:20px 18px}
    .filters{display:grid;grid-template-columns:1fr 1fr auto;gap:12px;align-items:end}
    @media(max-width:800px){.filters{grid-template-columns:1fr}}
    .field label{display:block;margin-bottom:6px;color:var(--muted);font-weight:800;font-size:.95rem}
    .picker-wrap{display:flex;align-items:center;gap:12px}
    .picker-btn,select{width:100%;border:1px solid var(--line);background:var(--surface);color:var(--text);
      border-radius:12px;padding:12px 14px;font-weight:700}
    .range-hint{color:var(--muted);font-weight:800;white-space:nowrap}
    #painel{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-top:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;
      text-align:center;transition:.2s;box-shadow:var(--shadow);cursor:pointer}
    .card.ok{border-left:6px solid var(--ok)}
    .card.bad{border-left:6px solid var(--bad)}
    .card h2{margin:0 0 6px;font-size:1.05rem}
    .card p{margin:4px 0;font-size:.95rem}
    .loading{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:60}
    .loading.show{display:flex}
    .spinner{width:74px;height:74px;border-radius:50%;border:6px solid rgba(255,255,255,.25);border-top-color:#fff;animation:spin 1s linear infinite}
    .loading p{color:#fff;font-weight:800;margin-top:12px}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <header>
    <div class="head">
      <a class="brand" href="#"><img src="https://github.com/ClenaStore/painel-principal/blob/main/img/GRUPO%20DV%20(1).png?raw=true"><span class="title">Entradas</span></a>
      <div class="grow"></div>
      <button id="themeToggle" class="btn">üåì Tema</button>
      <div class="user" id="userMenu">
        <button class="user-btn" type="button"><img src="https://github.com/ClenaStore/grupodv/blob/main/paste/Imagem%20do%20WhatsApp%20de%202025-09-08%20%C3%A0(s)%2011.54.12_884bebc9.jpg?raw=true"><strong>Leonardo</strong></button>
        <div class="user-menu"><a href="#">üë§ Meu Perfil</a><button onclick="handleLogout()">üö™ Sair</button></div>
      </div>
    </div>
  </header>

  <div id="loading" class="loading"><div><div class="spinner"></div><p>Carregando...</p></div></div>

  <div class="container">
    <div class="filters">
      <div class="field">
        <label>Empresa</label>
        <select id="empresaFiltro">
          <option value="">Todas</option>
          <option value="Mercatto Del√≠cia">Mercatto Del√≠cia</option>
          <option value="Del√≠cia Gourmet">Del√≠cia Gourmet</option>
          <option value="Villa Gourmet">Villa Gourmet</option>
        </select>
      </div>
      <div class="field"><label>&nbsp;</label><button id="btnFiltrar" class="btn">Filtrar</button></div>
    </div>
    <div id="painel"></div>
  </div>

<script>
const API_AGENDA="https://script.google.com/macros/s/AKfycbxJwRXw2lr2kK58EoHv-oUagd2FV2hvTHXRDJ5mFcNo5eZp3QlX7wX2KdrujAE5zPU-/exec";
const API_COUVERT="https://script.google.com/macros/s/AKfycbxxv-9kLzyqS9Qy8WX_qPp7UG8He3OaEbIxZMV3HoRaSpdBfRYqZZZODLQlIJZDufso/exec";
function BRL(v){return(Number(v)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});}
function showLoading(v){document.getElementById("loading").classList.toggle("show",!!v);}
const NORMALIZAR={
  "MERCATTO":"Mercatto Del√≠cia",
  "MERCATTO DEL√çCIA":"Mercatto Del√≠cia",
  "VILLA":"Villa Gourmet",
  "VILLA GOURMET":"Villa Gourmet",
  "DEL√çCIA GOURMET":"Del√≠cia Gourmet"
};
async function carregar(){
  showLoading(true);
  try{
    const empSel=document.getElementById("empresaFiltro").value;
    const ag=await(await fetch(API_AGENDA)).json();
    const cv=await(await fetch(API_COUVERT)).json();
    const porData={};
    ag.forEach(a=>{
      let emp=(NORMALIZAR[a.empresa?.toUpperCase()]||a.empresa);
      const d=a.data.split("T")[0];
      if(!porData[d])porData[d]={empresa:emp,pagos:0,couvert:0};
      porData[d].pagos+=+a.valor;
      porData[d].empresa=emp;
    });
    (cv.registros||[]).forEach(c=>{
      let emp=(NORMALIZAR[c.empresa?.toUpperCase()]||c.empresa);
      const d=c.data;
      if(!porData[d])porData[d]={empresa:emp,pagos:0,couvert:0};
      porData[d].couvert+=+c.total_dia;
      porData[d].empresa=emp;
    });
    const painel=document.getElementById("painel");painel.innerHTML="";
    Object.entries(porData).sort(([d1],[d2])=>new Date(d2)-new Date(d1)).forEach(([data,info])=>{
      if(empSel && info.empresa!==empSel) return;
      const lucro=info.couvert-info.pagos;
      painel.innerHTML+=`
        <div class="card ${lucro>=0?"ok":"bad"}">
          <h2>${info.empresa} ‚Äì ${data.split("-").reverse().join("/")}</h2>
          <p>üé§ Pago m√∫sicos: <b>${BRL(info.pagos)}</b></p>
          <p>üéüÔ∏è Couvert: <b>${BRL(info.couvert)}</b></p>
          <p>${lucro>=0?"‚úÖ Lucro":"‚ùå Preju√≠zo"}: <b>${BRL(lucro)}</b></p>
        </div>`;
    });
  }finally{showLoading(false);}
}
document.getElementById("btnFiltrar").onclick=()=>carregar();
document.getElementById("themeToggle").onclick=()=>{const cur=document.documentElement.getAttribute("data-theme")||"light";const next=cur==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",next);localStorage.setItem("dv_theme",next);}
const user=document.getElementById("userMenu");user.querySelector(".user-btn").onclick=()=>user.classList.toggle("open");
window.handleLogout=()=>{localStorage.removeItem("dv_theme");location.reload();}
carregar();
</script>
</body>
</html>
