<!DOCTYPE html> 
<html lang="pt-BR" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>An√°lise Financeira</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <!-- ================= ICONES DO SITE ================= -->
  <!-- üîΩ Substitua o LINK abaixo pela URL da SUA LOGO -->
  <link rel="apple-touch-icon" sizes="180x180" href="COLOQUE_AQUI_O_LINK_DA_SUA_LOGO.png">
  <link rel="icon" type="image/png" sizes="32x32" href="COLOQUE_AQUI_O_LINK_DA_SUA_LOGO.png">
  <link rel="icon" type="image/png" sizes="16x16" href="COLOQUE_AQUI_O_LINK_DA_SUA_LOGO.png">

  <!-- Permite abrir como app no iPhone -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="An√°lise Financeira">
  <meta name="mobile-web-app-capable" content="yes">
  <!-- ================================================== -->

  <style>
    :root{
      --bg: #0b1020;
      --surface: #10172a;
      --card: #0f172a;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --line: rgba(148,163,184,.25);
      --brand: #60a5fa;
      --brand-2: #22d3ee;
      --ring: rgba(99,102,241,.35);
      --shadow: 0 20px 60px rgba(2,6,23,.35);
      --chip-bg:#0b1220;
      --chip-active:#111827;
      --chip-text:#cbd5e1;
      --icon-bg: rgba(255,255,255,.06);
      --grad: linear-gradient(135deg, var(--brand), var(--brand-2));
    }
    /* Tema claro */
    [data-theme="light"]{
      --bg: #f6f7fb;
      --surface: #ffffff;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --line: #e5e7eb;
      --chip-bg:#eef2ff;
      --chip-active:#1f2937;
      --chip-text:#111827;
      --icon-bg: rgba(2,6,23,.06);
      --shadow: 0 16px 36px rgba(15,23,42,.08);
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ===== Tela de senha ===== */
    #gate{position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center; background: var(--bg);}
    #gate .box{width:min(92vw, 380px); background: var(--surface); border:1px solid var(--line); border-radius:16px; padding:22px 18px; box-shadow: var(--shadow); text-align:center; animation: fadeIn .25s ease;}
    #gate img{ width:84px; height:84px; object-fit:contain; margin-bottom:10px }
    #gate h1{ margin:8px 0 4px; font-size:20px }
    #gate p{ margin:0 0 14px; color:var(--muted); font-size:13px }
    #gate input{width:100%; padding:12px; border:1px solid var(--line); border-radius:12px; background: var(--card); color: var(--text); font-size:15px;}
    #gate button{margin-top:10px; width:100%; padding:12px; border:none; border-radius:12px; font-weight:800; cursor:pointer; background: var(--brand); color:#fff;}
    #gate .err{color:#dc2626; font-size:13px; margin-top:8px; display:none}
    @keyframes fadeIn{from{opacity:0; transform:translateY(6px)}to{opacity:1; transform:none}}

    /* ===== Header e layout ===== */
    header{position: sticky; top:0; z-index: 50; backdrop-filter: saturate(160%) blur(8px); background: color-mix(in srgb, var(--surface) 80%, transparent); border-bottom: 1px solid var(--line);}
    .head-wrap{max-width: 1200px; margin: 0 auto; padding: 14px 18px; display:flex; align-items:center; gap:12px;}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit;}
    .brand img{ height:42px }
    .title{font-weight: 800; letter-spacing:.2px; font-size: clamp(18px, 1.6vw, 22px);}
    .head-spacer{ flex:1 }
    .icon-btn{border:1px solid var(--line); background: var(--surface); color: var(--text); padding:10px 12px; border-radius: 12px; font-weight:800; cursor:pointer; transition:.2s transform, .2s box-shadow; text-decoration:none; display:inline-flex; align-items:center; gap:8px;}
    .icon-btn:hover{ transform: translateY(-2px); box-shadow: var(--shadow) }
    .only-desktop { display: inline-flex; }
    @media (max-width: 900px) { .only-desktop { display: none !important; } }

    .user{ position: relative; }
    .user-btn{display:flex; align-items:center; gap:10px; cursor:pointer; border:1px solid var(--line); background: var(--surface); padding:6px 8px; border-radius: 999px;}
    .user-btn img{width:34px; height:34px; border-radius:50%; object-fit:cover; background: var(--icon-bg);}
    .user-menu{position:absolute; right:0; top:110%; background: var(--surface); border:1px solid var(--line); border-radius:12px; box-shadow: var(--shadow); min-width:200px; padding:6px; display:none;}
    .user.open .user-menu{ display:block }
    .user-menu a, .user-menu button{display:flex; width:100%; background:transparent; color: var(--text); border:none; text-align:left; padding:10px 12px; border-radius:10px; cursor:pointer; text-decoration:none; font-weight:600;}
    .user-menu a:hover, .user-menu button:hover{ background: var(--icon-bg) }

    .hero{max-width:1200px; margin:16px auto 0; padding: 0 18px 18px;}
    .hero h2{ margin:8px 0 12px; font-size: clamp(18px,1.4vw,20px); color: var(--muted) }
    .tools{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .search{ flex:1; position:relative; }
    .search input{width:100%; border:1px solid var(--line); background: var(--surface); color: var(--text); border-radius:12px; padding:12px 14px 12px 40px; outline:none; box-shadow: inset 0 1px 0 rgba(255,255,255,.04);}
    .search .magnify{ position:absolute; left:12px; top:50%; transform: translateY(-50%); opacity:.6; }
    .chips{ display:flex; gap:8px; flex-wrap:wrap }
    .chip{border:1px solid var(--line); background: var(--chip-bg); color: var(--chip-text); padding:8px 12px; border-radius:999px; font-weight:700; cursor:pointer; user-select:none;}
    .chip.active{ background: var(--grad); color:#fff; border-color:transparent }

    .grid{max-width:1200px; margin: 6px auto 28px; padding: 0 18px; display:grid; gap:14px; grid-template-columns: repeat(12, minmax(0,1fr));}
    @media (max-width: 1160px){ .grid{ grid-template-columns: repeat(8, 1fr); } }
    @media (max-width: 760px){ .grid{ grid-template-columns: repeat(4, 1fr); } }

    .section-title{grid-column: 1 / -1; margin: 18px 0 6px; color: var(--muted); font-weight:800; letter-spacing:.2px;}
    .card{grid-column: span 3 / span 3; background: var(--card); border:1px solid var(--line); border-radius:16px; text-decoration:none; color:inherit; padding:16px; display:flex; gap:12px; align-items:center; transition:.15s transform, .15s box-shadow, .15s border-color; position:relative; overflow:hidden;}
    @media (max-width: 1160px){ .card{ grid-column: span 4 / span 4; } }
    @media (max-width: 760px){ .card{ grid-column: span 4 / span 4; } }
    .card::before{content:""; position:absolute; inset:0 0 auto 0; height:4px; background: var(--grad); opacity:.9;}
    .card:hover{ transform: translateY(-4px); box-shadow: var(--shadow); border-color: transparent; }
    .card .icon{width:46px; height:46px; border-radius:12px; display:grid; place-items:center; background: var(--icon-bg); font-size:22px; font-weight:800;}
    .card h3{ margin:0 0 3px; font-size:16px }
    .card p{ margin:0; color: var(--muted); font-size:13px }
    .badge{position:absolute; right:12px; top:12px; font-size:11px; font-weight:800; padding:4px 8px; border-radius:999px; border:1px solid var(--line); color: var(--muted); background: color-mix(in srgb, var(--surface) 90%, transparent);}

    footer{max-width:1200px; margin: 10px auto 30px; padding: 0 18px; color: var(--muted); font-size:12px; display:flex; justify-content:space-between; gap:12px; border-top:1px dashed var(--line); padding-top:12px;}
  </style>

  <script>
  (function(){
    const KEY = 'dv_pwd';
    const t = localStorage.getItem('dv_theme');
    if(t) document.documentElement.setAttribute('data-theme', t);

    const _f = window.fetch.bind(window);
    window.fetch = (input, init={})=>{
      const url = (typeof input === 'string') ? input : (input && input.url) || '';
      const headers = new Headers(init.headers || ((typeof input !== 'string' && input.headers) || {}));
      const pwd = localStorage.getItem(KEY) || '';
      if(url.startsWith('/api/') && pwd) headers.set('x-api-key', pwd);
      return _f(input, Object.assign({}, init, {headers}));
    };

    async function tryUnlockWith(pwd){
      if(!pwd) return false;
      try{ const r = await fetch('/api/ping', {headers:{'x-api-key':pwd}}); if(r.ok){ localStorage.setItem(KEY, pwd); return true; } return false; }
      catch{ localStorage.setItem(KEY, pwd); return true; }
    }

    async function ensureGate(){
      const app = document.getElementById('app');
      const gate = document.getElementById('gate');
      const err = document.getElementById('pwdErr');
      const input = document.getElementById('pwdInput');

      async function submit(){
        err.style.display='none';
        const ok = await tryUnlockWith((input.value||'').trim());
        if(ok){ gate.style.display='none'; app.hidden = false; hydrateUserFromStorage(); }
        else{ err.textContent='Senha incorreta.'; err.style.display='block'; input.select(); }
      }

      document.getElementById('pwdBtn').addEventListener('click', submit);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); submit(); } });

      const saved = localStorage.getItem(KEY);
      if(saved){ const ok = await tryUnlockWith(saved); if(ok){ gate.style.display='none'; app.hidden = false; hydrateUserFromStorage(); } else{ localStorage.removeItem(KEY); gate.style.display='flex'; setTimeout(()=>input.focus(), 50); } }
      else{ gate.style.display='flex'; setTimeout(()=>input.focus(), 50); }
    }
    window.addEventListener('DOMContentLoaded', ensureGate);

    window.handleLogout = function(){ try{ localStorage.removeItem(KEY); }catch{} location.reload(); };
    window.hydrateUserFromStorage = function(){ try{ const p = JSON.parse(localStorage.getItem('dv_profile')||'{}'); if(p && (p.nome || p.foto)){ if(p.foto) document.getElementById('userAvatar').src = p.foto; if(p.nome) document.getElementById('userName').textContent = p.nome; } }catch(e){} };
  })();
  </script>
</head>
<body>

  <!-- Gate -->
  <div id="gate" role="dialog" aria-modal="true" style="display:none">
    <div class="box">
      <!-- üîΩ Aqui tamb√©m substitua o LINK da logo -->
      <img src="COLOQUE_AQUI_O_LINK_DA_SUA_LOGO.png" alt="Grupo DV">
      <h1>Grupo DV</h1>
      <p>Digite a senha de acesso para entrar</p>
      <input id="pwdInput" type="password" placeholder="Senha">
      <button id="pwdBtn" type="button">Entrar</button>
      <div id="pwdErr" class="err"></div>
    </div>
  </div>

  <!-- App -->
  <div id="app" hidden>
    <header>
      <div class="head-wrap">
        <!-- üîΩ Substitua a logo tamb√©m aqui -->
        <a class="brand" href="index.html"><img src="COLOQUE_AQUI_O_LINK_DA_SUA_LOGO.png"><div class="title">An√°lise Financeira</div></a>
        <div class="head-spacer"></div>
        <a class="icon-btn only-desktop" href="index.relatorios.html">üìÑ Relat√≥rios</a>
        <button id="themeToggle" class="icon-btn" type="button">üåì Tema</button>
        <div class="user" id="userMenu">
          <button class="user-btn" type="button">
            <!-- üîΩ Avatar do usu√°rio -->
            <img id="userAvatar" src="COLOQUE_AQUI_O_LINK_DA_FOTO_DO_USUARIO.png">
            <strong id="userName" style="font-size:13px">Leonardo</strong>
          </button>
          <div class="user-menu"><a href="perfil.html">üë§ Meu Perfil</a><button onclick="handleLogout()">üö™ Sair</button></div>
        </div>
      </div>
    </header>

    <section class="hero">
      <h2>Selecione um painel ou filtre pelo nome</h2>
      <div class="tools">
        <div class="search" style="min-width:240px"><span class="magnify">üîé</span><input id="searchInput" type="search" placeholder="Buscar (atalho: / )"></div>
        <div class="chips" id="chips"><span class="chip active" data-cat="all">Todos</span><span class="chip" data-cat="financeiro">Financeiro</span><span class="chip" data-cat="vendas">Vendas</span><span class="chip" data-cat="operacoes">Opera√ß√µes</span><span class="chip" data-cat="qualidade">Qualidade</span></div>
      </div>
    </section>

    <main class="grid" id="grid">
      <!-- ... SEUS CARDS DE PAINEL AQUI (mantive igual ao que voc√™ j√° tinha) ... -->
    </main>

    <footer><div>¬© Grupo DV ‚Ä¢ Painel</div><div>Atalho: pressione <strong>/</strong> para buscar</div></footer>
  </div>

  <script>
    const searchInput = document.getElementById('searchInput');
    const chips = document.getElementById('chips');
    const cards = Array.from(document.querySelectorAll('.card'));
    let activeCat = 'all';
    function applyFilters(){if(!cards.length) return; const q = (searchInput?.value || '').toLowerCase().trim(); cards.forEach(card=>{const cat = card.getAttribute('data-cat'); const text = (card.getAttribute('data-title') || '').toLowerCase(); const matchCat = (activeCat==='all') || (cat===activeCat); const matchText = !q || text.includes(q); card.style.display = (matchCat && matchText) ? '' : 'none';});}
    chips?.addEventListener('click', (e)=>{const chip = e.target.closest('.chip'); if(!chip) return; chips.querySelectorAll('.chip').forEach(c=>c.classList.remove('active')); chip.classList.add('active'); activeCat = chip.getAttribute('data-cat'); applyFilters();});
    searchInput?.addEventListener('input', applyFilters);
    window.addEventListener('keydown', (e)=>{if(e.key === '/' && document.activeElement !== searchInput && !document.getElementById('app').hidden){e.preventDefault(); searchInput?.focus();}});
    const themeBtn = document.getElementById('themeToggle'); function toggleTheme(){const cur = document.documentElement.getAttribute('data-theme') || 'light'; const next = (cur==='light') ? 'dark' : 'light'; document.documentElement.setAttribute('data-theme', next); localStorage.setItem('dv_theme', next); if(themeBtn) themeBtn.textContent = 'üåì Tema';}
    themeBtn?.addEventListener('click', toggleTheme);
    const user = document.getElementById('userMenu'); user?.querySelector('.user-btn')?.addEventListener('click', ()=> user.classList.toggle('open')); window.addEventListener('click', (e)=>{ if(user && !user.contains(e.target)) user.classList.remove('open'); });
  </script>
</body>
</html>
