<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8">
<title>Grupo DV • Painel Integrado</title>
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">

<!-- Ícones -->
<link rel="apple-touch-icon" sizes="180x180" href="https://github.com/ClenaStore/grupodv/blob/main/paste/Financeiro.png?raw=true">
<link rel="icon" type="image/png" sizes="32x32" href="https://github.com/ClenaStore/grupodv/blob/main/paste/Financeiro.png?raw=true">
<link rel="icon" type="image/png" sizes="16x16" href="https://github.com/ClenaStore/grupodv/blob/main/paste/Financeiro.png?raw=true">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Grupo DV Painel">
<meta name="mobile-web-app-capable" content="yes">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg:#0b1020;--surface:#10172a;--card:#0f172a;
  --text:#e5e7eb;--muted:#94a3b8;--line:rgba(148,163,184,.25);
  --brand:#60a5fa;--brand-2:#22d3ee;--grad:linear-gradient(135deg,var(--brand),var(--brand-2));
  --shadow:0 20px 60px rgba(2,6,23,.35);
}
[data-theme="light"] {
  --bg:#f6f7fb;--surface:#fff;--card:#fff;--text:#0f172a;--muted:#475569;--line:#e5e7eb;
}
body {
  margin:0; font-family:'Inter',sans-serif; background:var(--bg); color:var(--text);
  transition:background .5s,color .5s;
}
header {
  position:sticky;top:0;z-index:40;
  background:color-mix(in srgb,var(--surface) 80%,transparent);
  border-bottom:1px solid var(--line);
  backdrop-filter:saturate(150%) blur(6px);
}
header .head {
  max-width:1200px;margin:auto;padding:14px 18px;
  display:flex;align-items:center;gap:10px;
}
.brand img {height:42px;border-radius:10px;}
.title {font-weight:800;font-size:1.2rem;}
.flex-1 {flex:1;}
.btn {
  border:1px solid var(--line);background:var(--surface);
  padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;
  color:var(--text);transition:.3s;
}
.btn:hover {background:var(--brand);color:#fff;}
main {
  max-width:1200px;margin:auto;padding:20px 18px;
}
section.kpis {
  display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:14px;margin-bottom:20px;
}
.kpi {
  background:var(--card);border:1px solid var(--line);
  border-radius:16px;padding:14px 16px;box-shadow:var(--shadow);
  animation:fadeInUp .8s ease forwards;opacity:0;transform:translateY(20px);
}
@keyframes fadeInUp {to{opacity:1;transform:translateY(0);}}
.kpi h3 {margin:0;color:var(--muted);font-size:.9rem;}
.kpi .value {font-weight:900;font-size:1.6rem;margin-top:4px;}
.grid {display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));}
.card {
  background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;
  text-decoration:none;color:inherit;display:flex;align-items:center;gap:12px;
  position:relative;overflow:hidden;transition:.25s;
}
.card::before {
  content:"";position:absolute;inset:0 0 auto 0;height:4px;background:var(--grad);
}
.card:hover {transform:translateY(-4px);box-shadow:var(--shadow);}
.icon {width:48px;height:48px;border-radius:12px;display:grid;place-items:center;
  background:rgba(255,255,255,.05);font-size:22px;}
.card h4 {margin:0;font-weight:800;}
.card p {margin:0;color:var(--muted);font-size:.85rem;}
footer {max-width:1200px;margin:30px auto;padding:0 18px;color:var(--muted);font-size:.8rem;text-align:center;border-top:1px dashed var(--line);padding-top:10px;}
.fade {animation:fade .6s ease;}
@keyframes fade{from{opacity:0;}to{opacity:1;}}
canvas{width:100%!important;max-height:200px;}
</style>
</head>
<body>

<!-- Gate -->
<div id="gate" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--bg);z-index:9999;">
  <div style="background:var(--surface);padding:24px;border-radius:16px;box-shadow:var(--shadow);width:min(92vw,360px);text-align:center;">
    <img src="https://github.com/ClenaStore/grupodv/blob/main/paste/Financeiro.png?raw=true" width="90" alt="">
    <h2>Grupo DV</h2>
    <p style="color:var(--muted)">Digite a senha de acesso</p>
    <input id="pwdInput" type="password" placeholder="Senha" style="width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:var(--card);color:var(--text)">
    <button id="pwdBtn" class="btn" style="width:100%;margin-top:10px;">Entrar</button>
    <div id="pwdErr" style="color:#ef4444;font-size:.8rem;margin-top:6px;display:none;">Senha incorreta.</div>
  </div>
</div>

<!-- App -->
<div id="app" hidden>
<header>
  <div class="head">
    <div class="brand"><img src="https://github.com/ClenaStore/grupodv/blob/main/paste/Financeiro.png?raw=true"><div class="title">Painel Grupo DV</div></div>
    <div class="flex-1"></div>
    <button id="themeBtn" class="btn">🌓 Tema</button>
  </div>
</header>

<main>
  <section class="kpis">
    <div class="kpi"><h3>💰 Faturamento (ontem)</h3><div class="value" id="fatValor">R$ 0,00</div><canvas id="fatChart"></canvas></div>
    <div class="kpi"><h3>🎯 Meta de Faturamento</h3><div class="value" id="metaValor">—</div></div>
    <div class="kpi"><h3>💳 Conciliação</h3><div class="value" id="concValor">—</div></div>
    <div class="kpi"><h3>❌ Cancelamentos</h3><div class="value" id="cancelValor">—</div></div>
    <div class="kpi"><h3>📅 Reservas</h3><div class="value" id="reservaValor">—</div></div>
  </section>

  <div class="grid">
    <a class="card fade" href="index.resumofinanceiro.html"><div class="icon">📊</div><div><h4>Resumo Financeiro</h4><p>Consolidação e entradas por categoria</p></div></a>
    <a class="card fade" href="index.conciliacao.html"><div class="icon">💳</div><div><h4>Conciliação</h4><p>Comparativo de recebíveis e bandeiras</p></div></a>
    <a class="card fade" href="index.meta.html"><div class="icon">🎯</div><div><h4>Meta de Faturamento</h4><p>Acompanhamento diário e previsão</p></div></a>
    <a class="card fade" href="index.cancelamentos.html"><div class="icon">❌</div><div><h4>Cancelamentos</h4><p>Motivos e impacto no período</p></div></a>
    <a class="card fade" href="index.reservas.html"><div class="icon">📅</div><div><h4>Reservas</h4><p>Capacidade e agendamentos</p></div></a>
  </div>
</main>

<footer>© Grupo DV — Painel Integrado • Atualizado automaticamente</footer>
</div>

<script>
const urls={
  financeiro:"https://script.google.com/macros/s/AKfycbyLjma7BgEdqtBsBnwZsssV4MrmkBlxpcYiFXl56GAHGr0vcQGdhm8ITVfHOSviMc_5/exec",
  conciliacao:"https://script.google.com/macros/s/AKfycbwHz1a4Shp_33lFZnFOMaO9HOKaLaQktrkVi2kgbiTsuMEjqO762bW_nGyICwh7Ekhw/exec",
  meta:"https://script.google.com/macros/s/AKfycbzyiL6yNCj_FYWiQ2PS88mthToCvWM1wJ0q7CQy8asyg-59L8YezKzFY6d-lgQU0ni3/exec",
  cancel:"https://script.google.com/macros/s/AKfycby6kNirWdyaFymip0MFrqTNoItMgqkXJrzwf41Qxe2P1j8BoBILtnyws8o4f5sUdg-T3w/exec",
  reservas:"https://script.google.com/macros/s/AKfycbxWbA4zKPe771UKHhq5N5Hq3LuLECoYa-a4S6dcb4wJvK03A8NDmnRZGOmoJ50rlNVP/exec"
};
const ontem=new Date();ontem.setDate(ontem.getDate()-1);const dataOntem=ontem.toISOString().split("T")[0];
const fmt=v=>Number(v||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

// Gate
const gate=document.getElementById('gate');const app=document.getElementById('app');
document.getElementById('pwdBtn').addEventListener('click',()=>{
  const val=document.getElementById('pwdInput').value.trim();
  if(val==="848663639"||val==="rh_salt_2025"){localStorage.setItem("dv_pwd",val);gate.style.display="none";app.hidden=false;loadAll();}
  else document.getElementById('pwdErr').style.display="block";
});

// Tema
document.getElementById('themeBtn').addEventListener('click',()=>{
  const cur=document.documentElement.getAttribute('data-theme');
  const next=(cur==="dark")?"light":"dark";
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('dv_theme',next);
});

// Load
async function loadAll(){
  await Promise.all([financeiro(),conciliacao(),meta(),cancelamentos(),reservas()]);
}
async function financeiro(){
  const r=await fetch(urls.financeiro);const j=await r.json();
  const ontemData=j.filter(x=>x.Data===dataOntem);
  const total=ontemData.reduce((a,b)=>a+Number(b.Valor||0),0);
  document.getElementById('fatValor').textContent=fmt(total);
  const porCat={};ontemData.forEach(x=>{porCat[x.Categoria]=(porCat[x.Categoria]||0)+Number(x.Valor||0)});
  const ctx=document.getElementById('fatChart');
  new Chart(ctx,{type:"bar",data:{labels:Object.keys(porCat),datasets:[{data:Object.values(porCat),backgroundColor:"rgba(96,165,250,.7)",borderRadius:6}]},
    options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:"#94a3b8"}},y:{ticks:{color:"#94a3b8"}}},animation:{duration:1200}}
  });
}
async function conciliacao(){
  const r=await fetch(urls.conciliacao);const j=await r.json();
  const perc=(j.reduce((a,b)=>a+(b.percentual||0),0)/j.length).toFixed(1);
  document.getElementById('concValor').textContent=perc+"%";
}
async function meta(){
  const r=await fetch(urls.meta);const j=await r.json();
  const real=j.reduce((a,b)=>a+Number(b.Realizado||0),0);
  const prev=j.reduce((a,b)=>a+Number(b.Previsto||0),0);
  const perc=((real/prev)*100).toFixed(1);
  document.getElementById('metaValor').textContent=perc+"% da meta";
}
async function cancelamentos(){
  const r=await fetch(urls.cancel);const j=await r.json();
  const ontem=j.filter(x=>x.data===dataOntem);
  const total=ontem.reduce((a,b)=>a+Number(b.valor||0),0);
  document.getElementById('cancelValor').textContent=fmt(total);
}
async function reservas(){
  const r=await fetch(`${urls.reservas}?acao=listar`);const j=await r.json();
  const hoje=new Date();const mes=hoje.getMonth(),ano=hoje.getFullYear();
  const mesRes=j.filter(x=>{const d=new Date(x.datahora||x.data);return d.getMonth()===mes&&d.getFullYear()===ano;});
  document.getElementById('reservaValor').textContent=mesRes.length+" reservas";
}
</script>
</body>
</html>
